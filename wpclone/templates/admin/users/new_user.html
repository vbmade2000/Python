{% extends 'admin/users/admin_base.html' %}
{% block css_theme_styles %}
<!-- BEGIN THEME STYLES -->
<link href="{{ STATIC_URL }}admin/css/style-metronic.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}admin/css/style.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}admin/css/style-responsive.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}admin/css/plugins.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}admin/css/themes/default.css" rel="stylesheet" type="text/css" id="style_color"/>
<link href="{{ STATIC_URL }}admin/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}css/style.css" rel="stylesheet" type="text/css"/>
    <!-- END THEME STYLES -->
{% endblock %}
{% block content_body %}
	<!-- BEGIN CONTENT -->
	<div class="page-content-wrapper">
		<div class="page-content">
			<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<div class="modal fade" id="portlet-config" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
							<h4 class="modal-title">Modal title</h4>
						</div>
						<div class="modal-body">
							 Widget settings form goes here
						</div>
						<div class="modal-footer">
							<button type="button" class="btn blue">Save changes</button>
							<button type="button" class="btn default" data-dismiss="modal">Close</button>
						</div>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
			<!-- /.modal -->
			<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<!-- BEGIN STYLE CUSTOMIZER -->
			<div class="theme-panel hidden-xs hidden-sm">
				<div class="toggler">
				</div>
				<div class="toggler-close">
				</div>
				<div class="theme-options">
					<div class="theme-option theme-colors clearfix">
						<span>
							 THEME COLOR
						</span>
						<ul>
							<li class="color-black current color-default" data-style="default">
							</li>
							<li class="color-blue" data-style="blue">
							</li>
							<li class="color-brown" data-style="brown">
							</li>
							<li class="color-purple" data-style="purple">
							</li>
							<li class="color-grey" data-style="grey">
							</li>
							<li class="color-white color-light" data-style="light">
							</li>
						</ul>
					</div>
					<div class="theme-option">
						<span>
							 Layout
						</span>
						<select class="layout-option form-control input-small">
							<option value="fluid" selected="selected">Fluid</option>
							<option value="boxed">Boxed</option>
						</select>
					</div>
					<div class="theme-option">
						<span>
							 Header
						</span>
						<select class="header-option form-control input-small">
							<option value="fixed" selected="selected">Fixed</option>
							<option value="default">Default</option>
						</select>
					</div>
					<div class="theme-option">
						<span>
							 Sidebar
						</span>
						<select class="sidebar-option form-control input-small">
							<option value="fixed">Fixed</option>
							<option value="default" selected="selected">Default</option>
						</select>
					</div>
					<div class="theme-option">
						<span>
							 Sidebar Position
						</span>
						<select class="sidebar-pos-option form-control input-small">
							<option value="left" selected="selected">Left</option>
							<option value="right">Right</option>
						</select>
					</div>
					<div class="theme-option">
						<span>
							 Footer
						</span>
						<select class="footer-option form-control input-small">
							<option value="fixed">Fixed</option>
							<option value="default" selected="selected">Default</option>
						</select>
					</div>
				</div>
			</div>
			<!-- END STYLE CUSTOMIZER -->
			<!-- BEGIN PAGE HEADER-->

			<!-- BEGIN PAGE CONTENT-->
<!--This is the error block -->
                    <div class="note note-success error">

            		</div>
<!--This is the success block -->
                    <div class="note note-success success">
                        success message
            		</div>


        <form method="post" action="">{% csrf_token %}
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><b>Username</b> <i>(required)</i></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="wp_username" name="wp_username" type="text" class="form-control"/>
				</div>
			</div>
			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><b>Email</b> <i>(required)</i></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="wp_email" name="wp_email" type="text" class="form-control"/>
				</div>
			</div>
			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><b>First Name</b></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="wp_first_name" name="wp_first_name" type="text" class="form-control"/>
				</div>
			</div>

			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><b>Last Name</b></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="wp_last_name" name="wp_last_name" type="text" class="form-control"/>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><b>Website</b></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="wp_website" name="wp_website" type="text" class="form-control"/>
				</div>
			</div>

			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><b>Password</b> <i>(required)</i></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="wp_password" name="wp_password" type="password" class="form-control"/>
				</div>
			</div>

			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><b>Repeat Password</b> <i>(required)</i></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="wp_repeat_password" name="wp_repeat_password" type="password" class="form-control"/>
				</div>
			</div>		

			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">

				</div>
				<div class="col-lg-3 col-md-3 col-sm-3 col-xs-12 margin-bottom-10">
					<div class="progress">
						<!--<div id="progress_message" class="progress-bar" style="width: 0%;width:100%;color:black;background-color:grey;">Strength Indicator-->
						<!--</div>-->
					</div>					 
				</div>
									
		<!--
		Add this div "<div class="progress-bar progress-bar-danger" style="width: 5%;">Weak</div>"
		for  weak strength password

		Add this div for <div class="progress-bar progress-bar-warning" style="width: 50%;">Medium</div>
		for medium class.

		Add this div for <div class="progress-bar progress-bar-success" style="width: 100%;">Very Strong</div>
		for strong password

		-->
				<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 margin-bottom-10">
						<i>Hint: The password should be at least seven characters long. To make it stronger, use
						uper and lower case letters, numbers and symbols like ! * ? $ % ^ &).
						</i>
				</div>
			</div>					


			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><b>Send Password?</b></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="wp_send_password" name="wp_send_password" type="checkbox" class=""/>
					Send this password to the new user by email.
				</div>
			</div>		
			
			<div class="row">
                <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
                    <label class="control-label" for="title"><b>Role</b></label>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
                    <select id="wp_role" name="wp_role">
                        {% for role in roles %}
                            {% ifequal role.name "Subscriber" %}
                                <option value="{{ role.id }}" selected>{{ role.name }}</option>
                            {% else %}
                                <option value="{{ role.id }}">{{ role.name }}</option>
                            {% endifequal %}
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
                    <button type="button" id="submit_btn" class="btn btn-info">Add user</button>
                </div>
            </div>
        </form>
			<!-- END PAGE CONTENT-->
		</div>
	</div>
	<!-- END CONTENT -->
    {% endblock %}
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
{% block js_page_level_plugins %}
<!-- BEGIN PAGE LEVEL PLUGINS -->
<!--<script src="{{ STATIC_URL }}admin/plugins/flot/jquery.flot.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/flot/jquery.flot.resize.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/flot/jquery.flot.categories.js" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
{% endblock %}
{% block js_page_level_scripts %}
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="{{ STATIC_URL }}admin/js/core/app.js"></script>
<script src="{{ STATIC_URL }}admin/js/custom/ecommerce-index.js"></script>

<!-- END PAGE LEVEL SCRIPTS -->
{% endblock %}
{% block javascript %}
<script type="text/javascript">
    jQuery(document).ready(function() {
        // initiate layout and plugins
        App.init();
    });
    $(document).ready(function() {
        // Initialize appendGrid
        /**
         * Required for Django's CSRF protection when using AJAX
         * Taken from here - http://docs.djangoproject.com/en/dev/ref/contrib/csrf/
         */

        function checkEmail(emailstring)
        {
            /* Function to validate email */
            var testresults;
            var str = emailstring;
            var filter = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
            if (filter.test(str)){
                testresults = true;
            }
            else{
                testresults = false;
            }
            return (testresults);
        }

        $(document).ajaxSend(function(event, xhr, settings) {
            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie != '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) == (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            function sameOrigin(url) {
                // url could be relative or scheme relative or absolute
                var host = document.location.host; // host + port
                var protocol = document.location.protocol;
                var sr_origin = '//' + host;
                var origin = protocol + sr_origin;
                // Allow absolute or scheme relative URLs to same origin
                return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
                        (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
                    // or any other URL that isn't scheme relative or absolute i.e relative.
                        !(/^(\/\/|http:|https:).*/.test(url));
            }
            function safeMethod(method) {
                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
            }

            if (!safeMethod(settings.type) && sameOrigin(settings.url)) {
                xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
            }
        });
        $('#submit_btn').click(function () {
        var data = JSON.stringify($('form').serializeObject());
            $(".error").empty();
        var parsedData = JSON.parse(data);
        var status = true;
                if ( !parsedData.wp_username){
                    $(".error").append("Please enter a username.</br>").show();
                    status = false;
                }
                if ( !parsedData.wp_email || checkEmail(parsedData.wp_email) == false){
                    $(".error").append("Please enter a valid email.</br>").show();
                    status = false;
                }
                if ( (!parsedData.wp_password || !parsedData.wp_repeat_password ) || ( parsedData.wp_password.length < 7
                        && parsedData.wp_password != parsedData.wp_repeat_password )){
                    $(".error").append("Please enter a password or password doesn't match.</br>").show();
                    status = false;
                }
                if ( status == true){
                    $(".error").hide();
                    $.ajax( {
                        type: "POST",
                        dataType: "JSON",
                        url: "{% url "create_user" %}",
                        data:{create_user:data},
                        success: function(result) {
                            if (result){
                                var error_code_length = result.error_codes.length;
                                var error_code_count = 0;
                                if (error_code_length == 0){
                                    /* Everything is successful */
                                    $(".success").html("<b>Successfully created</b>").show();
                                    window.location.replace("{% url "all_user" %}");
                                }
                                else{
                                    /* We have got problems */
                                    $(".error").empty();
                                    $(".success").hide();
                                    for(error_code_count=0; error_code_count<error_code_length; error_code_count++){
                                        var error_code = result.error_codes[error_code_count];
                                        if ( error_code == 1){
                                            $(".error").append("Please enter a username.</br>").show();
                                        }
                                        if ( error_code == 2){
                                            $(".error").append("Please enter a valid email.</br>").show();
                                        }
                                        if ( error_code == 3){
                                            $(".error").append("Please enter a password or password doesn't match.</br>").show();
                                        }
                                        if ( error_code == 4){
                                            $(".error").append("Username already exists</br>").show();
                                        }
                                    }

                                }
                            }
                        },
                        error: function(result) {
                            alert('error');
                        }
                    });
                }
    });
    });
</script>
<script>
        $.fn.serializeObject = function()
        {
            var o = {};
            var a = this.serializeArray();
            $.each(a, function() {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
        };
    </script>
<!-- END JAVASCRIPTS -->
<script>
	$(document).ready(function(){
		$('#wp_password').keyup(function(){
            var password = $('#wp_password').val();
            if(password.length < 7){
                $('.progress').html('<div class="progress-bar progress-bar-danger" style="width: 100%;">Minimum length 7</div>');
            }
            else{
                var strength = 0;
                if (password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)){
                    strength += 1
                }
                if(password.match(/([0-9])/)){
                    strength += 1
                }
                if(password.match(/([!,%,&,@,#,$,^,*,?,_,~])/)){
                    strength += 1
                }
                if(strength == 3){
                    $('.progress').html('<div class="progress-bar progress-bar-success" style="width: 100%;">Very Strong</div>');
                }
                else{
                    $('.progress').html('<div class="progress-bar progress-bar-warning" style="width: 50%;">Medium</div>');
                }
            }
		});

        $('#wp_repeat_password').keyup(function(){
            var password = $('#wp_password').val();
            var repeat_password = $('#wp_repeat_password').val();
            if(password.length < 7){
                $('.progress').html('<div class="progress-bar progress-bar-danger" style="width: 100%;">Minimum length 7</div>');
            }
            else{
                var strength = 0
                if (password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)){
                    strength += 1
                }
                if(password.match(/([0-9])/)){
                    strength += 1
                }
                if(password.match(/([!,%,&,@,#,$,^,*,?,_,~])/)){
                    strength += 1
                }
                if(strength == 3){
                    $('.progress').html('<div class="progress-bar progress-bar-success" style="width: 100%;">Very Strong</div>');
                }
                else{
                    $('.progress').html('<div class="progress-bar progress-bar-warning" style="width: 50%;">Medium</div>');
                }


                    if(password == repeat_password){
                    $('.progress').html('<div class="progress-bar progress-bar-success" style="width: 100%;">Matched</div>');
                    }
                    else{
                            $('.progress').html('<div class="progress-bar progress-bar-danger" style="width: 100%;">Not Matched</div>');
                    }
            }
        });
	});
</script>
{% endblock %}