{% extends 'admin/users/admin_base.html' %}
{% block css_page_level_plugin_styles %}
<!-- BEGIN PAGE LEVEL PLUGIN STYLES -->
<link href="{{ STATIC_URL }}admin/plugins/gritter/css/jquery.gritter.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}admin/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}admin/plugins/fullcalendar/fullcalendar/fullcalendar.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}admin/plugins/jqvmap/jqvmap/jqvmap.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}admin/plugins/jquery-easy-pie-chart/jquery.easy-pie-chart.css" rel="stylesheet" type="text/css"/>
<!-- END PAGE LEVEL PLUGIN STYLES -->
{% endblock %}
{% block css_theme_styles %}
<!-- BEGIN THEME STYLES -->
<link href="{{ STATIC_URL }}admin/css/style-metronic.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}admin/css/style.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}admin/css/style-responsive.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}admin/css/plugins.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}admin/css/pages/tasks.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}admin/css/themes/default.css" rel="stylesheet" type="text/css" id="style_color"/>
<link href="{{ STATIC_URL }}admin/css/print.css" rel="stylesheet" type="text/css" media="print"/>
<link href="{{ STATIC_URL }}admin/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_URL }}css/style.css" rel="stylesheet" type="text/css"/>
<!-- END THEME STYLES -->
{% endblock %}

    {% block content_body %}
	<!-- BEGIN CONTENT -->
	<div class="page-content-wrapper">
		<div class="page-content">
			<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<div class="modal fade" id="portlet-config" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
							<h4 class="modal-title">Modal title</h4>
						</div>
						<div class="modal-body">
							 Widget settings form goes here
						</div>
						<div class="modal-footer">
							<button type="button" class="btn blue">Save changes</button>
							<button type="button" class="btn default" data-dismiss="modal">Close</button>
						</div>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
			<!-- /.modal -->
			<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<!-- BEGIN STYLE CUSTOMIZER -->
			<div class="theme-panel hidden-xs hidden-sm">
				<div class="toggler">
				</div>
				<div class="toggler-close">
				</div>
				<div class="theme-options">
					<div class="theme-option theme-colors clearfix">
						<span>
							 THEME COLOR
						</span>
						<ul>
							<li class="color-black current color-default" data-style="default">
							</li>
							<li class="color-blue" data-style="blue">
							</li>
							<li class="color-brown" data-style="brown">
							</li>
							<li class="color-purple" data-style="purple">
							</li>
							<li class="color-grey" data-style="grey">
							</li>
							<li class="color-white color-light" data-style="light">
							</li>
						</ul>
					</div>
					<div class="theme-option">
						<span>
							 Layout
						</span>
						<select class="layout-option form-control input-small">
							<option value="fluid" selected="selected">Fluid</option>
							<option value="boxed">Boxed</option>
						</select>
					</div>
					<div class="theme-option">
						<span>
							 Header
						</span>
						<select class="header-option form-control input-small">
							<option value="fixed" selected="selected">Fixed</option>
							<option value="default">Default</option>
						</select>
					</div>
					<div class="theme-option">
						<span>
							 Sidebar
						</span>
						<select class="sidebar-option form-control input-small">
							<option value="fixed">Fixed</option>
							<option value="default" selected="selected">Default</option>
						</select>
					</div>
					<div class="theme-option">
						<span>
							 Sidebar Position
						</span>
						<select class="sidebar-pos-option form-control input-small">
							<option value="left" selected="selected">Left</option>
							<option value="right">Right</option>
						</select>
					</div>
					<div class="theme-option">
						<span>
							 Footer
						</span>
						<select class="footer-option form-control input-small">
							<option value="fixed">Fixed</option>
							<option value="default" selected="selected">Default</option>
						</select>
					</div>
				</div>
			</div>
			<!-- END STYLE CUSTOMIZER -->
			<!-- BEGIN PAGE HEADER-->

			<!-- BEGIN PAGE CONTENT-->
			<!--Error block-->
            <div class="note note-success error">

            </div>

           <!--Success block-->
            <div class="note note-success success">
                Profile updated.
            </div>
			<h3>Profile</h3>
			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4><b>Personal Options</b></h4></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">

				</div>
			</div>
            
            <div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>Visual Editor</h4></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="rich_editing" name="rich_editing" type="checkbox" class="" {% if rich_editing == 'true' %} checked {% endif %}/>
					Display the visual editor when writing
				</div>
			</div>

			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>Admin Color Scheme</h4></label>
				</div>
				<div class="col-lg-9 col-md-9 col-sm-7 col-xs-12 margin-bottom-10">

				</div>
			</div>			
			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>Keyboard Shortcuts</h4></label>
				</div>
				<div class="col-lg-6 col-md-6 col-sm-7 col-xs-12 margin-bottom-10">
					<input id="comment_shortcuts" name="comment_shortcuts" type="checkbox" {% if comment_shortcuts == 'true' %} checked {% endif %}/>
					Enable keyboard shortcuts for comment moderation. <a href="#">More Information</a>
				</div>
			</div>	
			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>Toolbar</h4></label>
				</div>
				<div class="col-lg-6 col-md-6 col-sm-7 col-xs-12 margin-bottom-10">
					<input id="admin_bar_front" name="admin_bar_front" type="checkbox" {% if comment_shortcuts == 'true' %} checked {% endif %}/>
					Show toolbar when viewing site.
				</div>
			</div>

			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4><b>Name</b></h4></label>
				</div>
			</div>			
			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>Username</h4></label>
				</div>
				<div class="col-lg-8 col-md-8 col-sm-5 col-xs-12 margin-bottom-10">
					<div class="col-md-6" style="padding-left:0px !important">
						<input id="user_login" name="user_login" type="text" disabled="disabled"  class="form-control col-md-6" value="{{ username_obj.username }}"/>
					</div>
					<div class="col-md-4">
						<h5>Username cannot be changed</h5>
					</div>
				</div>
			</div>
			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>First Name</h4></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="first_name" name="first_name" type="text" class="form-control" value="{{ username_obj.first_name }}"/>
				</div>
			</div>

			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>Last Name</h4></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="last_name" name="last_name" type="text" class="form-control" value="{{ username_obj.last_name }}"/>
				</div>
			</div>
{#            {% if username_obj %}#}
            {% for detail in username_obj.wpuser_set.all %}
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>Nickname<i>(required)</i></h4></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="nickname" name="nickname" type="text" class="form-control" value="{{ detail.user_nicename }}"/>
				</div>
			</div>


			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>Display name publicly as</h4></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<select id="display_name" name="display_name">
						<option>root</option>
					</select>
				</div>
			</div>			
			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4><b>Contact Info</b></h4></label>
				</div>
			</div>			
			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>E-mail<i>(required)</i></h4></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="email" name="email" type="email" value="{{ username_obj.email }}" class="form-control"/>
				</div>
			</div>		

			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>Website</h4></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="url" name="url" type="text" class="form-control" value="{{ detail.user_url }}"/>
				</div>
			</div>
            {% endfor %}
{#            {% endif %}#}
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4><b>About Yourself</b></h4></label>
				</div>
			</div>						
			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>Biographical Info</h4></label>
				</div>
				<div class="col-lg-6 col-md-6 col-sm-5 col-xs-12 margin-bottom-10">
					<textarea id="description" name="description" class="form-control"rows="2" >{{ description }}</textarea>
					Share a little biographical information to fill out your profile. This may be shown publicly.

				</div>
			</div>					
			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>New Password</h4></label>
				</div>
				<div class="col-lg-7 col-md-7 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="new_password" name="new_password" type="password" class="form-control" style="width:64%"/>
					<p>If you would like to change the password type a new one. Otherwise leave this blank.</p>
				</div>
			</div>		
			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<label class="control-label" for="title"><h4>Repeat Password</h4></label>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-5 col-xs-12 margin-bottom-10">
					<input id="repeat_password" name="repeat_password" type="password" class="form-control"/>
				</div>
			</div>


            <div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">

				</div>
				<div class="col-lg-3 col-md-3 col-sm-3 col-xs-12 margin-bottom-10">
					<div class="progress">
						<div class="progress-bar" style="width: 0%;width:100%;color:black;background-color:grey;">Strength Indicator
						</div>
					</div>					 
				</div>
									
		<!--
		Add this div "<div class="progress-bar progress-bar-danger" style="width: 5%;">Weak</div>"
		for  weak strength password

		Add this div for <div class="progress-bar progress-bar-warning" style="width: 50%;">Medium</div>
		for medium class.

		Add this div for <div class="progress-bar progress-bar-success" style="width: 100%;">Very Strong</div>
		for strong password

		-->
				<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 margin-bottom-10">
						<i>Hint: The password should be at least seven characters long. To make it stronger, use
						upper and lower case letters, numbers and symbols like ! * ? $ % ^ &).
						</i>
				</div>
			</div>					

			
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 margin-bottom-10">
					<input type="button" class="btn btn-info" value="Update Profile" id="btnUpdateProfile" name="btnUpdateProfile"/>
				</div>
			</div>		
			
			
			<!-- END PAGE CONTENT-->
		</div>
	</div>
	<!-- END CONTENT -->
    {% endblock %}


{% block js_page_level_plugins %}
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script src="{{ STATIC_URL }}admin/plugins/jqvmap/jqvmap/jquery.vmap.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/jqvmap/jqvmap/maps/jquery.vmap.russia.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/jqvmap/jqvmap/maps/jquery.vmap.world.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/jqvmap/jqvmap/maps/jquery.vmap.europe.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/jqvmap/jqvmap/maps/jquery.vmap.germany.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/jqvmap/jqvmap/maps/jquery.vmap.usa.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/jqvmap/jqvmap/data/jquery.vmap.sampledata.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/flot/jquery.flot.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/flot/jquery.flot.resize.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/flot/jquery.flot.categories.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/jquery.pulsate.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/bootstrap-daterangepicker/moment.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/bootstrap-daterangepicker/daterangepicker.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/gritter/js/jquery.gritter.js" type="text/javascript"></script>
<!-- IMPORTANT! fullcalendar depends on jquery-ui-1.10.3.custom.min.js for drag & drop support -->
<script src="{{ STATIC_URL }}admin/plugins/fullcalendar/fullcalendar/fullcalendar.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/jquery-easy-pie-chart/jquery.easy-pie-chart.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/plugins/jquery.sparkline.min.js" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
{% endblock %}
{% block js_page_level_scripts %}
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="{{ STATIC_URL }}admin/js/core/app.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/js/custom/index.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}admin/js/custom/tasks.js" type="text/javascript"></script>
<!-- END PAGE LEVEL SCRIPTS -->
{% endblock %}

{% block javascript %}
<script>
    jQuery(document).ready(function() {
        // initiate layout and plugins
        App.init();
    });
	$(document).ready(function(){
		$('#new_password').keyup(function(){
            var password = $('#new_password').val();
            if(password.length < 7){
                $('.progress').html('<div class="progress-bar progress-bar-danger" style="width: 100%;">Minimum length 7</div>');
            }
            else{
                var strength = 0;
                if (password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)){
                    strength += 1
                }
                if(password.match(/([0-9])/)){
                    strength += 1
                }
                if(password.match(/([!,%,&,@,#,$,^,*,?,_,~])/)){
                    strength += 1
                }
                if(strength == 3){
                    $('.progress').html('<div class="progress-bar progress-bar-success" style="width: 100%;">Very Strong</div>');
                }
                else{
                    $('.progress').html('<div class="progress-bar progress-bar-warning" style="width: 50%;">Medium</div>');
                }
            }
		});

        $('#repeat_password').keyup(function(){
            var password = $('#new_password').val();
            var repeat_password = $('#repeat_password').val();
            if(password.length < 7){
                $('.progress').html('<div class="progress-bar progress-bar-danger" style="width: 100%;">Minimum length 7</div>');
            }
            else{
                var strength = 0;
                if (password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)){
                    strength += 1
                }
                if(password.match(/([0-9])/)){
                    strength += 1
                }
                if(password.match(/([!,%,&,@,#,$,^,*,?,_,~])/)){
                    strength += 1
                }
                if(strength == 3){
                    $('.progress').html('<div class="progress-bar progress-bar-success" style="width: 100%;">Very Strong</div>');
                }
                else{
                    $('.progress').html('<div class="progress-bar progress-bar-warning" style="width: 50%;">Medium</div>');
                }

                if(password == repeat_password){
                $('.progress').html('<div class="progress-bar progress-bar-success" style="width: 100%;">Matched</div>');
                }
                else{
                        $('.progress').html('<div class="progress-bar progress-bar-danger" style="width: 100%;">Not Matched</div>');
                }
            }
        });
     });


    $(document).ready(function(){
        $("#btnUpdateProfile").click(function(e){
            e.preventDefault();
            var rich_editing = $("#rich_editing").is(":checked");
            var comment_shortcuts = $("#comment_shortcuts").is(":checked");
            var admin_bar_front = $("#admin_bar_front").is(":checked");
            var user_login = $("#user_login").val();
            var first_name = $("#first_name").val();
            var last_name = $("#last_name").val();
            var nickname = $("#nickname").val();
            var description = $("#description").val();
            var display_name = $("#display_name").val();
            var email = $("#email").val();
            var url = $("#url").val();
            var new_password = $("#new_password").val();
            var repeat_password = $("#repeat_password").val();
            var user_details = {
                'rich_editing': rich_editing,
                'comment_shortcuts': comment_shortcuts,
                'admin_bar_front': admin_bar_front,
                'user_login': user_login,
                'first_name': first_name,
                'last_name': last_name,
                'nickname': nickname,
                'description': description,
                'display_name': display_name,
                'email': email,
                'url': url,
                'new_password': new_password,
                'repeat_password': repeat_password
            }
            var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
            var flag = true;
            $('.error').empty();
            if(regex.test(email) == false){
                $(".error").append("<li> Please enter a valid e-mail address.</li>").show();
                var flag = false;
            }
            if(nickname.trim() == ""){
                $(".error").append("<li> Please enter a nickname</li>").show();
                var flag = false;
            }
            if(new_password.length > 0 && new_password.length < 7){
                alert("Hello");
                $(".error").append("<li> Minimum Password length is 7.</li>").show();
                var flag = false;
            }
            else if(new_password != repeat_password){
                $(".error").append("<li> Password mismatch.</li>").show();
                var flag = false;
            }

            if(flag == false){
                $(".success").hide();
                $('html, body').animate({
                            scrollTop: $(".error").offset().top - 100
                        }, 1000);
                }
            if(flag == true ){
            $.ajax({
                    url: "{% url 'update_user' user_id %}",
                type: 'POST',
                data: user_details,
                dataType: 'json',
                success: function(result){
                    if(result.status == 0){
                        /* We got a success */
                        $('.error').hide();
                        $(".success").show();
                        $('html, body').animate({
                            scrollTop: $(".success").offset().top - 100
                        }, 1000);
                    }
                    else{
                        /* We got a problem */
                        $('.error').empty();
                        var error_codes = result.error_codes;
                        var error_codes_length = error_codes.length;
                        var error_code_counter = 0;
                        for(error_code_counter=0; error_code_counter<error_codes_length; error_code_counter++){
                            if(error_codes[error_code_counter] == 1){
                                $(".error").append("<li>Please enter a nickname.</li>").show();
                            }
                            else if(error_codes[error_code_counter] == 2){
                                $(".error").append("<li> Please enter an e-mail address.</li>").show();
                            }
                            else if(error_codes[error_code_counter] == 4){
                                $(".error").append("<li> Password mismatch.</li>").show();
                            }
                            else if(error_codes[error_code_counter] == 5){
                                $(".error").append("<li> Minimum password length is 7.</li>").show();
                            }
                        }
                        $('html, body').animate({
                            scrollTop: $(".error").offset().top - 100
                        }, 1000);
                    }
                },
                error: function(data){
                    $(".error").append("<li>Unknown Error.</li>").show();
                },
                complete: function(){
{#                    alert("Completed");#}
                }
            });
           }
        });
    });
    </script>
{% endblock %}

